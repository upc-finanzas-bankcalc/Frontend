<div class="results-container">
    <div class="header">
        <h1>An√°lisis de Bono</h1>
        <p>Resultados del C√°lculo Financiero</p>
    </div>

    <div class="bond-summary">
        <div class="summary-item">
            <div class="summary-label">Valor Nominal</div>
            <div class="summary-value">{{ bondData.valorNominal | currency:bondData.moneda:'symbol':'1.2-2' }}</div>
        </div>
        <div class="summary-item">
            <div class="summary-label">Valor Comercial</div>
            <div class="summary-value">{{ bondData.valorComercial | currency:bondData.moneda:'symbol':'1.2-2' }}</div>
        </div>
        <div class="summary-item">
            <div class="summary-label">Tasa Cup√≥n</div>
            <div class="summary-value">{{ bondData.tasaInteresAnual / 100 | percent:'1.2-2' }}</div>
        </div>
        <div class="summary-item">
            <div class="summary-label">Plazo</div>
            <div class="summary-value">{{ bondData.numeroAnos }} a√±os</div>
        </div>
        <div class="summary-item">
            <div class="summary-label">Frecuencia</div>
            <div class="summary-value">{{ getFrecuenciaPago(bondData.frecuenciaPago) }}</div>
        </div>
    </div>

    <div class="results-content">
        <!-- Indicadores Financieros -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    üìä Indicadores Financieros
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">M√©tricas clave que eval√∫an la rentabilidad, riesgo y caracter√≠sticas del bono desde diferentes perspectivas.</span>
                    </span>
                </div>
                <div class="section-subtitle">M√©tricas de rendimiento y riesgo calculadas</div>
            </div>
            <div class="section-content">
                <div class="indicators-grid">
                    <div class="indicator-card highlight">
                        <div class="indicator-icon">üí∞</div>
                        <div class="indicator-value">{{ bondMetrics.trea / 100 | percent:'1.2-2' }}</div>
                        <div class="indicator-label">TREA</div>
                        <div class="indicator-description">Tasa de Rendimiento Efectivo Anual para el inversor</div>
                    </div>
                    <div class="indicator-card warning">
                        <div class="indicator-icon">üí∏</div>
                        <div class="indicator-value">{{ bondMetrics.tcea / 100 | percent:'1.2-2' }}</div>
                        <div class="indicator-label">TCEA</div>
                        <div class="indicator-description">Tasa de Costo Efectivo Anual para el emisor</div>
                    </div>
                    <div class="indicator-card">
                        <div class="indicator-icon">‚è±Ô∏è</div>
                        <div class="indicator-value">{{ bondMetrics.duracion | number:'1.2-2' }}</div>
                        <div class="indicator-label">Duraci√≥n</div>
                        <div class="indicator-description">Tiempo promedio ponderado de recuperaci√≥n de flujos</div>
                    </div>
                    <div class="indicator-card">
                        <div class="indicator-icon">üìà</div>
                        <div class="indicator-value">{{ bondMetrics.duracionModificada | number:'1.2-2' }}</div>
                        <div class="indicator-label">Duraci√≥n Modificada</div>
                        <div class="indicator-description">Sensibilidad del precio ante cambios de tasa</div>
                    </div>
                    <div class="indicator-card">
                        <div class="indicator-icon">üîÑ</div>
                        <div class="indicator-value">{{ bondMetrics.convexidad | number:'1.1-1' }}</div>
                        <div class="indicator-label">Convexidad</div>
                        <div class="indicator-description">Medida de curvatura para cambios amplios de tasa</div>
                    </div>
                    <div class="indicator-card highlight">
                        <div class="indicator-icon">üéØ</div>
                        <div class="indicator-value">{{ bondMetrics.precioMaximo | currency:bondData.moneda:'symbol':'1.0-0' }}</div>
                        <div class="indicator-label">Precio M√°ximo</div>
                        <div class="indicator-description">Precio m√°ximo que pagar√≠a el mercado</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flujo de Caja -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    üíµ Flujo de Caja por Per√≠odo
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Detalle completo de todos los flujos de efectivo proyectados durante la vida del bono, incluyendo cupones y amortizaci√≥n.</span>
                    </span>
                </div>
                <div class="section-subtitle">Cronograma detallado de pagos y flujos netos</div>
            </div>
            <div class="section-content">
                <div class="table-container">
                    <table class="cash-flow-table">
                        <thead>
                            <tr>
                                <th>Per√≠odo</th>
                                <th>Fecha de Pago</th>
                                <th>Cuota</th>
                                <th>Inter√©s</th>
                                <th>Amortizaci√≥n</th>
                                <th>Saldo Pendiente</th>
                                <th>Flujo Neto</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let row of cashFlowData" [class.highlight-initial]="row.periodo === 0" (click)="showPeriodDetails(row.periodo)">
                                <td class="period-cell">{{ row.periodo }}</td>
                                <td>{{ row.fecha }}</td>
                                <td [ngClass]="{'currency': row.periodo > 0}">{{ row.periodo > 0 ? (row.cuota | currency:bondData.moneda:'symbol':'1.2-2') : '-' }}</td>
                                <td [ngClass]="{'currency': row.periodo > 0}">{{ row.periodo > 0 ? (row.interes | currency:bondData.moneda:'symbol':'1.2-2') : '-' }}</td>
                                <td [ngClass]="{'currency': row.periodo > 0}">{{ row.periodo > 0 ? (row.amortizacion | currency:bondData.moneda:'symbol':'1.2-2') : '-' }}</td>
                                <td class="currency">{{ row.saldoPendiente | currency:bondData.moneda:'symbol':'1.2-2' }}</td>
                                <td class="currency" [ngClass]="{'positive': row.flujoNeto > 0, 'negative': row.flujoNeto < 0}">{{ row.flujoNeto | currency:bondData.moneda:'symbol':'1.2-2' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Gr√°fico de Flujos -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    üìä Visualizaci√≥n de Flujos
                </div>
                <div class="section-subtitle">Representaci√≥n gr√°fica de los flujos de caja</div>
            </div>
            <div class="section-content">
                <div class="chart-container">
                    <canvas id="cashFlowChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="actions-bar">
        <button class="btn btn-secondary" (click)="goBack()">Nuevo An√°lisis</button>
        <button class="btn btn-success" (click)="exportToPDF()">Exportar PDF</button>
        <button class="btn btn-primary" (click)="exportToExcel()">Exportar Excel</button>
    </div>

    <div class="loading" *ngIf="loading">
        <div class="spinner"></div>
        <p>Generando reporte...</p>
    </div>
</div>